<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">




<title>ES 2021 | Boomsi&#39;s blog</title>

<link rel="stylesheet" href="https://boomsi.github.io//css/styles.css">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" 
integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.3.1/jquery.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/zenburn.min.css" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="https://boomsi.github.io//js/highlight.js"></script>






<div class="container">
    <nav class="navbar level">
      <div class="navbar-brand">
          <a class="nav-item" href="https://boomsi.github.io/"><h1 class="title is-3">Boomsi&#39;s blog</h1></a>
      </div>           
      <div class="navbar-menu has-text-centered is-active">
          <div class="navbar-end is-centered">
              
                <a href="https://boomsi.github.io/about" rel="me">
                  <span class="icon">
                    <i class="fas fa-info"></i>
                  </span>
                </a>
              
                <a href="https://github.com/boomsi" rel="me">
                  <span class="icon">
                    <i class="fab fa-github"></i>
                  </span>
                </a>
              
                <a href="https://www.linkedin.com/in/natarajmb/" rel="me">
                  <span class="icon">
                    <i class="fab fa-linkedin-in"></i>
                  </span>
                </a>
              
                <a href="https://twitter.com/natarajmb" rel="me">
                  <span class="icon">
                    <i class="fab fa-twitter"></i>
                  </span>
                </a>
              
           </div>
      </div>
    </nav>
  </div>

<div class="container">
  <h2 class="subtitle is-6">
    Create: August 6, 2021
    <br />
    Last Modify: Oct 14, 2021
  </h2>
  <h1 class="subtitle is-size-4-mobile is-size-3-desktop">ES 2021</h1>
  <div class="content">
    <h3 id="features">Features</h3>
<ol>
<li>
<p>数字分隔符(Numeric Separators)</p>
<ul>
<li><code>Node v12.5.0+</code></li>
<li><a href="https://babeljs.io/docs/en/babel-plugin-proposal-numeric-separator">@babel/plugin-proposal-numeric-separator</a></li>
</ul>
<p>为提高数字的可读性而加入的新特性
经测试在十六进制、二进制也可使用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">十进制</span> <span style="color:#f92672">--&gt;</span>
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">decimal</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100_000_000_000</span> <span style="color:#75715e">// 100000000000
</span><span style="color:#75715e"></span>
<span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">二进制</span> <span style="color:#f92672">--&gt;</span>
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">binary</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0b1</span><span style="color:#ae81ff">_1</span>      <span style="color:#75715e">// 3
</span><span style="color:#75715e"></span>
<span style="color:#75715e">&lt;!--</span> <span style="color:#a6e22e">十六进制</span> <span style="color:#f92672">--&gt;</span>
<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">hex</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xa</span><span style="color:#ae81ff">_1</span>         <span style="color:#75715e">// 161
</span></code></pre></div></li>
<li>
<p>Promise.any()</p>
<p><code>Node 15.0.0+</code></p>
<p>Promise 静态方法目前四种 <code>Promise.all()</code> <code>Promise.race()</code> <code>Promise.allSettled()</code> <code>Promise.any()</code></p>
<p>简单来说</p>
<ul>
<li><code>Promise.all()</code>
所有 Promise 状态都 <code>fulfilled</code> ，才 <code>resolve</code>，否则 <code>reject</code></li>
<li><code>Promise.allSettled()</code>
所有 Promise 状态均变更 (<code>fulfilled|rejected</code>) 才结束</li>
<li><code>Promise.race()</code>
存在 Promise 状态变更 <code>fulfilled|rejected</code>，就 <code>resolve|reject</code></li>
<li><code>Promise.any()</code>
忽略 <code>rejected</code>，存在 Promise 状态变更为 <code>fulfilled</code>，就结束，如果全部 <code>rejected</code>，抛出 <code>AggregateError: All promises were rejected</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
        <span style="color:#a6e22e">reject</span>(<span style="color:#e6db74">&#39;err&#39;</span>)
    }, <span style="color:#ae81ff">500</span>)
})
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">delay1000</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
        <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;delay1000&#39;</span>)
    }, <span style="color:#ae81ff">500</span>)
})
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">delay2000</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise((<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) =&gt; {
    <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
        <span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;delay2000&#39;</span>)
    }, <span style="color:#ae81ff">500</span>)
})

Promise.<span style="color:#a6e22e">all</span>([<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;err&#39;</span>
Promise.<span style="color:#a6e22e">all</span>([<span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> [<span style="color:#e6db74">&#39;delay1000&#39;</span>, <span style="color:#e6db74">&#39;delay2000&#39;</span>]
Promise.<span style="color:#a6e22e">allSettled</span>([<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> [{ <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;rejected&#34;</span>, <span style="color:#e6db74">&#34;reason&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;err&#34;</span> }, { <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;fulfilled&#34;</span>, <span style="color:#e6db74">&#34;value&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1000</span> }, { <span style="color:#e6db74">&#34;status&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;fulfilled&#34;</span>, <span style="color:#e6db74">&#34;value&#34;</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">2000</span> }]
Promise.<span style="color:#a6e22e">race</span>([<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;err&#39;</span>
Promise.<span style="color:#a6e22e">race</span>([<span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;delay1000&#39;</span>
Promise.<span style="color:#a6e22e">any</span>([<span style="color:#a6e22e">err</span>, <span style="color:#a6e22e">delay1000</span>, <span style="color:#a6e22e">delay2000</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;delay1000&#39;</span>
Promise.<span style="color:#a6e22e">any</span>([<span style="color:#a6e22e">err</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>))
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;AggregateError: All promises were rejected&#39;</span>
Promise.<span style="color:#a6e22e">any</span>([<span style="color:#a6e22e">err</span>])
    .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">res</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">res</span>))
    .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">err</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">errors</span>))
<span style="color:#f92672">&gt;</span> [<span style="color:#e6db74">&#39;err&#39;</span>]
</code></pre></div></li>
<li>
<p>WeakRef and FinalizationRegistry</p>
<ul>
<li>
<p>WeakRef 保留对另一对象的弱引用，不会阻止被引用对象被垃圾回收；相对的，一个普通的引用就是强引用，只有当该对象没有任何强引用时，JavaScript 引擎才会销毁该对象并回收该对象所占用的内存空间；而在该对象被垃圾回收之后，就无法通过弱引用来获取该对象。</p>
</li>
<li>
<p>FinalizationRegistry 当一个在注册表中注册的对象被垃圾回收时，请求在某个时间点上调用一个清理回调</p>
</li>
</ul>
<p>使用场景暂未遇到
参考 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakRef">MDN</a></p>
</li>
<li>
<p>String.prototype.replaceAll</p>
<p><code>Node 15.0.0+</code></p>
<p>使用上同 String.prototype.replace，也不会改变原字符，不同之处在于会对目标字符串所有匹配的关键词做替换，原来基本上都是使用正则匹配，即 <code>str.replace(/xxx/g, 'xxx')</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abcadeafga&#39;</span>
<span style="color:#75715e">//在这之前是这样处理
</span><span style="color:#75715e"></span><span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/a/g</span>, <span style="color:#e6db74">&#39;1&#39;</span>)

<span style="color:#75715e">// String.prototype.replaceAll
</span><span style="color:#75715e"></span><span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">replaceAll</span>(<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;1&#39;</span>)
<span style="color:#75715e">// 1bc1de1fg1
</span><span style="color:#75715e"></span><span style="color:#a6e22e">str</span>.<span style="color:#a6e22e">replaceAll</span>(<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;_&#39;</span>)
<span style="color:#75715e">// _a_b_c_a_d_e_a_f_g_a_
</span><span style="color:#75715e"></span>
</code></pre></div><blockquote>
<p>需要注意的一点是 <code>replaceAll</code> 的第一个参数如果是正则需要加 <code>g</code></p>
</blockquote>
<p><strong>例外</strong>
当替换值为 <code>$$</code>, <code>$&amp;</code>, <code>$\``, </code>and $'` 时，替换后的结果可能并不是我们需要的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#39;apple&#39;</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#39;$$&#39;</span>)
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;$pple&#39;</span>
</code></pre></div><p>这时可以将函数第二个参数，返回值为想要替换成的值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#39;apple&#39;</span>.<span style="color:#a6e22e">replaceAll</span>(<span style="color:#e6db74">&#39;a&#39;</span>, () =&gt; <span style="color:#e6db74">&#39;$$&#39;</span>)
<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#34;$$pple&#34;</span>
</code></pre></div></li>
<li>
<p>逻辑赋值操作符（Logincal Assignment Operators）</p>
<p><code>Node 15.0.0+</code></p>
<ol>
<li><code>||=</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">a</span> <span style="color:#f92672">||=</span> <span style="color:#a6e22e">b</span>
<span style="color:#75715e">/** babel 转译后 **/</span>
<span style="color:#a6e22e">a</span> <span style="color:#f92672">||</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>)
</code></pre></div><ol start="2">
<li><code>&amp;&amp;=</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">a</span> <span style="color:#f92672">&amp;&amp;=</span> <span style="color:#a6e22e">b</span>
<span style="color:#75715e">/** babel 转译后 **/</span>
<span style="color:#a6e22e">a</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>);
</code></pre></div><ol start="3">
<li><code>??=</code></li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#a6e22e">a</span> <span style="color:#f92672">??=</span> <span style="color:#a6e22e">b</span> <span style="color:#75715e">// 转换成 ES2020 的写法，即 `a ?? (a = b)`
</span><span style="color:#75715e"></span><span style="color:#75715e">/** babel 转译后 **/</span>
(<span style="color:#ae81ff">_</span><span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">a</span>) <span style="color:#f92672">!==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#ae81ff">_</span><span style="color:#a6e22e">a</span> <span style="color:#f92672">!==</span> <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">_</span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
</code></pre></div></li>
</ol>

  </div>
</div>
<div class="container has-text-centered">
    
</div>

<div class="container has-text-centered">
  
</div>
<section class="section">
  <div class="container has-text-centered">
    <p>&copy; 2019</p>
  </div>
</section>


